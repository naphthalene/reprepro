#
# Generated by Chef
#

server {
  listen 80;
  server_name <%= node['reprepro']['fqdn'] %>;

  access_log /var/log/nginx/apt-access.log;
  error_log /var/log/nginx/apt-error.log;

  location ^~ /<%= node['reprepro']['distribution'] %> {
    alias <%= node['reprepro']['repo_dir'] %>;
    expires 0;
    add_header Cache-Control private;
    location ~ /(.*)/conf {deny all;}
    location ~ /(.*)/db {deny all;}
    autoindex  on;
  }
}

<% if node['reprepro']['ssl'] -%>
server {
  listen 443 ssl;
  server_name <%= node['reprepro']['fqdn'] %>;

  access_log /var/log/nginx/apt-access.log;
  error_log /var/log/nginx/apt-error.log;

  ssl_certificate <%= node['nginx']['ssl_certificate'] %>;
  ssl_certificate_key <%= node['nginx']['ssl_certificate_key'] %>;

  location ^~ /<%= node['reprepro']['distribution'] %> {
    alias <%= node['reprepro']['repo_dir'] %>;
    expires 0;
    add_header Cache-Control private;
    location ~ /(.*)/conf {deny all;}
    location ~ /(.*)/db {deny all;}
    autoindex  on;
  }
}
<% end -%>
